# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 2.5 Lakh

```
SELECT id, name, age, city, income
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 250000
);

```

**Output:**

<img width="1242" height="517" alt="image" src="https://github.com/user-attachments/assets/ef0124c0-c0e9-4e60-9634-d30d60bd55d9" />

**Question 2**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```
SELECT
    T1.ord_no,
    T1.purch_amt,
    T1.ord_date,
    T1.customer_id,
    T1.salesman_id
FROM
    orders T1
INNER JOIN
    salesman T2 ON T1.salesman_id = T2.salesman_id
WHERE
    T2.city = 'New York';

```

**Output:**

<img width="1238" height="444" alt="image" src="https://github.com/user-attachments/assets/9a87b0dd-bc6d-4f25-8038-9993cfee9d14" />

**Question 3**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi and age below 30

Sample table: CUSTOMERS

```
SELECT
    *
FROM
    CUSTOMERS
WHERE
    ADDRESS = 'Delhi'
AND
    AGE < 30
ORDER BY
    ID ASC;

```

**Output:**

<img width="1235" height="345" alt="image" src="https://github.com/user-attachments/assets/2ed68c06-9b05-4cb7-b212-77436e1be639" />

**Question 4**
---
Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

```
SELECT student_id, student_name, subject, grade
FROM Grades g
WHERE grade = (
    SELECT MAX(grade)
    FROM Grades
    WHERE subject = g.subject
);

```

**Output:**

<img width="1237" height="437" alt="image" src="https://github.com/user-attachments/assets/8d390b5e-768d-44fe-b687-34489eec48de" />


**Question 5**
---
Write a SQL query to Retrieve the names and cities of customers who have the same city as customers with IDs 3 and 7

```
SELECT name, city
FROM customer
WHERE city IN (
    SELECT city
    FROM customer
    WHERE id IN (3, 7)
);

```

**Output:**

<img width="628" height="443" alt="Screenshot 2025-11-10 134406" src="https://github.com/user-attachments/assets/0dec13ba-74df-4a2a-b445-6b8730fccce1" />


**Question 6**
---
From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

```
SELECT
    T1.salesman_id,
    T1.name
FROM
    salesman T1
JOIN
    customer T2 ON T1.salesman_id = T2.salesman_id
GROUP BY
    T1.salesman_id, T1.name
HAVING
    COUNT(T2.customer_id) > 1
ORDER BY
    T1.salesman_id;

```

**Output:**

<img width="580" height="461" alt="image" src="https://github.com/user-attachments/assets/6055a022-df18-4859-a0fa-8225569853c9" />


**Question 7**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $1500.

Sample table: CUSTOMERS

```
SELECT *
FROM CUSTOMERS
WHERE SALARY > 1500;

```

**Output:**

<img width="1230" height="595" alt="image" src="https://github.com/user-attachments/assets/35aa9cb0-b6c6-4eac-9e71-770f5fbc2d7a" />



**Question 8**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million

```
SELECT id, name, age, city, income
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 1000000
);

```

**Output:**

<img width="1234" height="412" alt="image" src="https://github.com/user-attachments/assets/1bbc4df6-679e-4c38-9488-c60eed94b3ce" />

**Question 9**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose AGE is LESS than $30

```
SELECT *
FROM CUSTOMERS
WHERE AGE < 30;

```

**Output:**

<img width="1234" height="562" alt="image" src="https://github.com/user-attachments/assets/9ecad855-13ad-425a-9089-e742a43f62c7" />

**Question 10**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.

Sample table: CUSTOMERS

```
SELECT *
FROM CUSTOMERS
WHERE SALARY > 4500;

```

**Output:**

<img width="1237" height="421" alt="image" src="https://github.com/user-attachments/assets/07beab4e-7aaf-4ea4-9f27-cd473fc56353" />


## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
